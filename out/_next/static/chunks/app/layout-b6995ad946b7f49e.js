(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8673:function(e,r,t){Promise.resolve().then(t.bind(t,5925)),Promise.resolve().then(t.t.bind(t,2489,23)),Promise.resolve().then(t.t.bind(t,2998,23)),Promise.resolve().then(t.bind(t,9850))},9850:function(e,r,t){"use strict";t.r(r),t.d(r,{Providers:function(){return n}});var a=t(7437),o=t(5403);function n(e){let{children:r}=e;return(0,a.jsx)(o.H,{children:r})}},5403:function(e,r,t){"use strict";t.d(r,{H:function(){return d},a:function(){return l}});var a=t(7437),o=t(2265),n=t(7007),s=t(4086),i=t(6831),c=t(5925);const u=(0,o.createContext)(void 0);function d(e){let{children:r}=e;const[t,d]=(0,o.useState)(null),[l,p]=(0,o.useState)(null),[m,f]=(0,o.useState)(!0);(0,o.useEffect)((()=>{const e=(0,n.Aj)(i.I8,(async e=>{if(p(e),e)try{const a=await(0,s.QT)((0,s.JU)(i.db,"users",e.uid));if(a.exists()){var r,t;const o=a.data();d({id:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:o.role||"user",hospitalId:o.hospitalId,createdAt:(null===(r=o.createdAt)||void 0===r?void 0:r.toDate())||new Date,updatedAt:(null===(t=o.updatedAt)||void 0===t?void 0:t.toDate())||new Date})}else{const r={id:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:"user",createdAt:new Date,updatedAt:new Date};await(0,s.pl)((0,s.JU)(i.db,"users",e.uid),{...r,createdAt:new Date,updatedAt:new Date}),d(r)}}catch(o){var a;if(console.error("Error fetching user data:",o),"unavailable"===o.code||(null===(a=o.message)||void 0===a?void 0:a.includes("offline"))){console.warn("Firestore hors ligne - cr\xe9ation d'un utilisateur local temporaire");const r={id:e.uid,email:e.email,displayName:e.displayName||"Utilisateur",photoURL:e.photoURL,role:"user",createdAt:new Date,updatedAt:new Date};d(r),c.default.success("Mode hors ligne activ\xe9")}else c.default.error("Erreur lors du chargement des donn\xe9es utilisateur")}else d(null);f(!1)}));return()=>e()}),[]);const h={user:t,firebaseUser:l,loading:m,signInWithEmail:async(e,r)=>{try{await(0,n.e5)(i.I8,e,r),c.default.success("Connexion r\xe9ussie !")}catch(t){throw console.error("Error signing in:",t),c.default.error("Erreur de connexion : "+t.message),t}},signInWithGoogle:async()=>{try{await(0,n.rh)(i.I8,i.Vv),c.default.success("Connexion Google r\xe9ussie !")}catch(e){throw console.error("Error signing in with Google:",e),c.default.error("Erreur de connexion Google : "+e.message),e}},signUpWithEmail:async(e,r,t)=>{try{const{user:a}=await(0,n.Xb)(i.I8,e,r);await(0,n.ck)(a,{displayName:t});const o={id:a.uid,email:a.email,displayName:t,role:"user",createdAt:new Date,updatedAt:new Date};await(0,s.pl)((0,s.JU)(i.db,"users",a.uid),{...o,createdAt:new Date,updatedAt:new Date}),c.default.success("Compte cr\xe9\xe9 avec succ\xe8s !")}catch(a){throw console.error("Error signing up:",a),c.default.error("Erreur lors de la cr\xe9ation du compte : "+a.message),a}},logout:async()=>{try{await(0,n.w7)(i.I8),c.default.success("D\xe9connexion r\xe9ussie")}catch(e){console.error("Error signing out:",e),c.default.error("Erreur lors de la d\xe9connexion")}},updateUserRole:async(e,r)=>{try{await(0,s.r7)((0,s.JU)(i.db,"users",e),{role:r,updatedAt:new Date}),c.default.success("R\xf4le utilisateur mis \xe0 jour")}catch(t){throw console.error("Error updating user role:",t),c.default.error("Erreur lors de la mise \xe0 jour du r\xf4le"),t}},createFirstSuperAdmin:async e=>{try{const r=(await(0,s.PL)((0,s.hJ)(i.db,"users"))).docs.find((r=>r.data().email===e));r?(await(0,s.r7)((0,s.JU)(i.db,"users",r.id),{role:"super_admin",updatedAt:new Date}),c.default.success("Super admin cr\xe9\xe9 avec succ\xe8s"),window.location.reload()):c.default.error("Utilisateur non trouv\xe9")}catch(r){console.error("Error creating super admin:",r),c.default.error("Erreur lors de la cr\xe9ation du super admin")}}};return(0,a.jsx)(u.Provider,{value:h,children:r})}function l(){const e=(0,o.useContext)(u);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}},6831:function(e,r,t){"use strict";t.d(r,{I8:function(){return c},Vv:function(){return u},db:function(){return d}});var a=t(994),o=t(7007),n=t(4086),s=t(9584);const i=(0,a.ZF)({apiKey:"AIzaSyBLpLQIqKcWgUVYDttXit1x5nRrcFB1RmM",authDomain:"hemoconnect-ec751.firebaseapp.com",projectId:"hemoconnect-ec751",storageBucket:"hemoconnect-ec751.firebasestorage.app",messagingSenderId:"324649213432",appId:"1:324649213432:web:77683bec35f3fe9b4a8a0d"}),c=(0,o.v0)(i),u=new o.hJ;u.setCustomParameters({prompt:"select_account"});const d=(0,n.ad)(i);(0,s.cF)(i)},2489:function(){},2998:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[358,717,265,971,472,744],(function(){return r=8673,e(e.s=r);var r}));var r=e.O();_N_E=r}]);