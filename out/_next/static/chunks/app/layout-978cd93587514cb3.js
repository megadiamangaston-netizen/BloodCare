(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9700:function(e,r,t){Promise.resolve().then(t.t.bind(t,4811,23)),Promise.resolve().then(t.bind(t,9064)),Promise.resolve().then(t.t.bind(t,2778,23)),Promise.resolve().then(t.bind(t,8847))},8847:function(e,r,t){"use strict";t.d(r,{Providers:function(){return a}});var o=t(7437),n=t(4603);function a(e){let{children:r}=e;return(0,o.jsx)(n.H,{children:r})}},4603:function(e,r,t){"use strict";t.d(r,{H:function(){return d},a:function(){return l}});var o=t(7437),n=t(2265),a=t(3301),s=t(5978),i=t(6410),c=t(9064);const u=(0,n.createContext)(void 0);function d(e){let{children:r}=e;const[t,d]=(0,n.useState)(null),[l,p]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0);(0,n.useEffect)((()=>{const e=(0,a.Aj)(i.I8,(async e=>{if(p(e),e)try{const o=await(0,s.QT)((0,s.JU)(i.db,"users",e.uid));if(o.exists()){var r,t;const n=o.data();d({id:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:n.role||"user",hospitalId:n.hospitalId,createdAt:(null===(r=n.createdAt)||void 0===r?void 0:r.toDate())||new Date,updatedAt:(null===(t=n.updatedAt)||void 0===t?void 0:t.toDate())||new Date})}else{const r={id:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:"user",createdAt:new Date,updatedAt:new Date};await(0,s.pl)((0,s.JU)(i.db,"users",e.uid),{...r,createdAt:new Date,updatedAt:new Date}),d(r)}}catch(n){var o;if(console.error("Error fetching user data:",n),"unavailable"===n.code||(null===(o=n.message)||void 0===o?void 0:o.includes("offline"))){console.warn("Firestore hors ligne - cr\xe9ation d'un utilisateur local temporaire");const r={id:e.uid,email:e.email,displayName:e.displayName||"Utilisateur",photoURL:e.photoURL,role:"user",createdAt:new Date,updatedAt:new Date};d(r),c.ZP.success("Mode hors ligne activ\xe9")}else c.ZP.error("Erreur lors du chargement des donn\xe9es utilisateur")}else d(null);h(!1)}));return()=>e()}),[]);const w={user:t,firebaseUser:l,loading:m,signInWithEmail:async(e,r)=>{try{await(0,a.e5)(i.I8,e,r),c.ZP.success("Connexion r\xe9ussie !")}catch(t){throw console.error("Error signing in:",t),c.ZP.error("Erreur de connexion : "+t.message),t}},signInWithGoogle:async()=>{try{await(0,a.rh)(i.I8,i.Vv),c.ZP.success("Connexion Google r\xe9ussie !")}catch(e){throw console.error("Error signing in with Google:",e),c.ZP.error("Erreur de connexion Google : "+e.message),e}},signUpWithEmail:async(e,r,t)=>{try{const{user:o}=await(0,a.Xb)(i.I8,e,r);await(0,a.ck)(o,{displayName:t});const n={id:o.uid,email:o.email,displayName:t,role:"user",createdAt:new Date,updatedAt:new Date};await(0,s.pl)((0,s.JU)(i.db,"users",o.uid),{...n,createdAt:new Date,updatedAt:new Date}),c.ZP.success("Compte cr\xe9\xe9 avec succ\xe8s !")}catch(o){throw console.error("Error signing up:",o),c.ZP.error("Erreur lors de la cr\xe9ation du compte : "+o.message),o}},logout:async()=>{try{await(0,a.w7)(i.I8),c.ZP.success("D\xe9connexion r\xe9ussie")}catch(e){console.error("Error signing out:",e),c.ZP.error("Erreur lors de la d\xe9connexion")}},updateUserRole:async(e,r)=>{try{await(0,s.r7)((0,s.JU)(i.db,"users",e),{role:r,updatedAt:new Date}),c.ZP.success("R\xf4le utilisateur mis \xe0 jour")}catch(t){throw console.error("Error updating user role:",t),c.ZP.error("Erreur lors de la mise \xe0 jour du r\xf4le"),t}},createFirstSuperAdmin:async e=>{try{const r=(await(0,s.PL)((0,s.hJ)(i.db,"users"))).docs.find((r=>r.data().email===e));r?(await(0,s.r7)((0,s.JU)(i.db,"users",r.id),{role:"super_admin",updatedAt:new Date}),c.ZP.success("Super admin cr\xe9\xe9 avec succ\xe8s"),window.location.reload()):c.ZP.error("Utilisateur non trouv\xe9")}catch(r){console.error("Error creating super admin:",r),c.ZP.error("Erreur lors de la cr\xe9ation du super admin")}}};return(0,o.jsx)(u.Provider,{value:w,children:r})}function l(){const e=(0,n.useContext)(u);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}},6410:function(e,r,t){"use strict";t.d(r,{I8:function(){return c},Vv:function(){return u},db:function(){return d}});var o=t(738),n=t(3301),a=t(5978),s=t(62);const i=(0,o.ZF)({apiKey:"AIzaSyBLpLQIqKcWgUVYDttXit1x5nRrcFB1RmM",authDomain:"hemoconnect-ec751.firebaseapp.com",projectId:"hemoconnect-ec751",storageBucket:"hemoconnect-ec751.firebasestorage.app",messagingSenderId:"324649213432",appId:"1:324649213432:web:77683bec35f3fe9b4a8a0d"}),c=(0,n.v0)(i),u=new n.hJ;u.setCustomParameters({prompt:"select_account"});const d=(0,a.ad)(i);(0,s.cF)(i)},2778:function(){},4811:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[2,358,139,341,971,117,744],(function(){return r=9700,e(e.s=r);var r}));var r=e.O();_N_E=r}]);