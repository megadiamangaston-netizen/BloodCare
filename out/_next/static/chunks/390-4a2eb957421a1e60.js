"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{3002:function(e,t,r){r.d(t,{Z:function(){return c}});var o=r(7437),n=r(4603),a=r(9376),s=r(2265),i=r(429),l=r(8906);function c(e){let{children:t,requiredRole:r,fallbackPath:c="/"}=e;const{user:d,loading:u}=(0,n.a)(),m=(0,a.useRouter)();if((0,s.useEffect)((()=>{u||d||m.push(c)}),[d,u,m,c]),u)return(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,o.jsx)(i.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full"})});if(!d)return null;return(Array.isArray(r)?r.includes(d.role):d.role===r)?(0,o.jsx)(o.Fragment,{children:t}):(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:(0,o.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl p-8 shadow-xl max-w-md w-full text-center",children:[(0,o.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,o.jsx)(l.Z,{className:"text-red-600",size:32})}),(0,o.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Acc\xe8s restreint"}),(0,o.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions n\xe9cessaires pour acc\xe9der \xe0 cette page."}),(0,o.jsx)("button",{onClick:()=>m.push("/"),className:"bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg transition-colors",children:"Retour \xe0 l'accueil"})]})})}},6334:function(e,t,r){var o=r(7437),n=r(2265),a=r(429);const s=(0,n.forwardRef)(((e,t)=>{let{variant:r="primary",size:n="md",loading:s=!1,children:i,className:l="",...c}=e;return(0,o.jsxs)(a.E.button,{ref:t,whileHover:{scale:1.02},whileTap:{scale:.98},className:"".concat("inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500",secondary:"bg-secondary-600 hover:bg-secondary-700 text-white focus:ring-secondary-500",outline:"border-2 border-primary-600 text-primary-600 hover:bg-primary-600 hover:text-white focus:ring-primary-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500",destructive:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500"}[r]," ").concat({sm:"px-3 py-2 text-sm",md:"px-4 py-2.5 text-base",lg:"px-6 py-3 text-lg"}[n]," ").concat(l),disabled:s||c.disabled,...c,children:[s&&(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i]})}));s.displayName="Button",t.Z=s},2827:function(e,t,r){var o=r(7437);const n=(0,r(2265).forwardRef)(((e,t)=>{let{label:r,error:n,icon:a,className:s="",...i}=e;return(0,o.jsxs)("div",{className:"w-full",children:[r&&(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r}),(0,o.jsxs)("div",{className:"relative",children:[a&&(0,o.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:a}),(0,o.jsx)("input",{ref:t,className:"\n              w-full px-3 py-3 border border-gray-300 rounded-lg \n              focus:ring-2 focus:ring-primary-500 focus:border-transparent\n              placeholder-gray-400 transition-all duration-200\n              ".concat(a?"pl-10":"","\n              ").concat(n?"border-red-500 ring-2 ring-red-200":"","\n              ").concat(s,"\n            "),...i})]}),n&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:n})]})}));n.displayName="Input",t.Z=n},2190:function(e,t,r){r.d(t,{Z:function(){return d}});var o=r(7437),n=r(2265),a=r(3774),s=r(6540),i=r(8896),l=r(6334),c=r(8237);function d(e){let{latitude:t,longitude:r,onLocationSelect:d,campaigns:u=[],showCampaigns:m=!1,className:g=""}=e;const p=(0,n.useRef)(null),[h,f]=(0,n.useState)(null),[x,w]=(0,n.useState)(null),[y,v]=(0,n.useState)([]),[b,j]=(0,n.useState)(!0),[N,E]=(0,n.useState)(null),[A,C]=(0,n.useState)(!1);(0,n.useEffect)((()=>{(0,c.$I)().then((()=>{(()=>{if(p.current)try{const e=t&&r?{lat:t,lng:r}:{lat:3.8667,lng:11.5167},o=new window.google.maps.Map(p.current,{center:e,zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!0,scaleControl:!0});let n=null;m||(n=new window.google.maps.Marker({position:e,map:o,draggable:!0,title:"Position de la campagne"}),n.addListener("dragend",(()=>{const e=n.getPosition();e&&d(e.lat(),e.lng())}))),m||o.addListener("click",(e=>{if(e.latLng){const t=e.latLng.lat(),r=e.latLng.lng();n.setPosition({lat:t,lng:r}),d(t,r)}})),f(o),w(n),j(!1),m&&u.length>0&&Z(o,u)}catch(N){console.error("Erreur initialisation carte:",N),E("Erreur d'initialisation de la carte: ".concat(N instanceof Error?N.message:"Erreur inconnue")),j(!1)}})()})).catch((e=>{console.error("Erreur chargement Google Maps:",e),E(e.message||"Erreur lors du chargement de Google Maps"),j(!1)}))}),[]);const Z=(e,t)=>{y.forEach((e=>e.setMap(null)));const r=[];if(t.forEach(((t,o)=>{var n,a;if(!(null===(n=t.location)||void 0===n?void 0:n.latitude)||!(null===(a=t.location)||void 0===a?void 0:a.longitude))return void console.warn("Campagne ".concat(t.id," sans coordonn\xe9es valides"));const s={lat:t.location.latitude,lng:t.location.longitude};let i="#FF6B6B";"active"===t.status?i="#4ECB71":"upcoming"===t.status?i="#45B7D1":"completed"===t.status&&(i="#96A3B4");const l=new window.google.maps.Marker({position:s,map:e,title:t.title,icon:{path:"M12,2C8.13,2 5,5.13 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9C19,5.13 15.87,2 12,2M12,7A2,2 0 0,1 14,9A2,2 0 0,1 12,11A2,2 0 0,1 10,9A2,2 0 0,1 12,7Z",fillColor:i,fillOpacity:.9,strokeColor:"#FFFFFF",strokeWeight:2,scale:2.2,anchor:{x:12,y:22}}}),c=new window.google.maps.InfoWindow({content:'\n          <div class="p-3 max-w-sm">\n            <h3 class="font-bold text-lg text-gray-800 mb-2">'.concat(t.title,'</h3>\n            <p class="text-sm text-gray-600 mb-2">').concat(t.description,'</p>\n            <div class="space-y-1 text-sm">\n              <p><strong>\ud83c\udfe5 H\xf4pital:</strong> ').concat(t.hospitalName,"</p>\n              <p><strong>\ud83d\udccd Adresse:</strong> ").concat(t.location.address,"</p>\n              <p><strong>\ud83e\ude78 Groupes recherch\xe9s:</strong> ").concat(t.targetBloodTypes.join(", "),'</p>\n              <p><strong>\ud83d\udcca Statut:</strong> <span class="px-2 py-1 rounded text-xs font-medium \n                ').concat("active"===t.status?"bg-green-100 text-green-800":"upcoming"===t.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800",'">\n                ').concat("active"===t.status?"\ud83d\udfe2 Active":"upcoming"===t.status?"\ud83d\udd35 \xc0 venir":"\u26ab Termin\xe9e","\n              </span></p>\n            </div>\n          </div>\n        ")});l.addListener("click",(()=>{r.forEach((e=>{e.infoWindow&&e.infoWindow.close()})),c.open(e,l)})),l.infoWindow=c,r.push(l)})),v(r),console.log("\u2705 ".concat(r.length," marqueurs de campagnes cr\xe9\xe9s")),r.length>0){const o=new window.google.maps.LatLngBounds;t.forEach((e=>{var t,r;(null===(t=e.location)||void 0===t?void 0:t.latitude)&&(null===(r=e.location)||void 0===r?void 0:r.longitude)&&o.extend({lat:e.location.latitude,lng:e.location.longitude})})),e.fitBounds(o),1===r.length&&e.setZoom(Math.min(e.getZoom(),14)),console.log("\ud83d\udccd Vue ajust\xe9e pour inclure toutes les campagnes")}};(0,n.useEffect)((()=>{h&&m&&u.length>0&&Z(h,u)}),[u,h,m]),(0,n.useEffect)((()=>{if(h&&x&&t&&r){const e={lat:t,lng:r};x.setPosition(e),h.setCenter(e)}}),[t,r,h,x]);return N?(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 ".concat(g),children:(0,o.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,o.jsx)(a.Z,{className:"mr-2",size:20}),(0,o.jsx)("span",{className:"text-sm",children:N})]})}):(0,o.jsx)("div",{className:g,children:(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsxs)(l.Z,{type:"button",variant:"outline",onClick:()=>{if(C(!0),!navigator.geolocation)return E("G\xe9olocalisation non support\xe9e"),void C(!1);navigator.geolocation.getCurrentPosition((e=>{const t=e.coords.latitude,r=e.coords.longitude;if(h&&x){const e={lat:t,lng:r};x.setPosition(e),h.setCenter(e),h.setZoom(15)}d(t,r),C(!1)}),(e=>{console.error("Erreur g\xe9olocalisation:",e),E("Impossible d'obtenir votre position"),C(!1)}),{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},disabled:A||b,className:"flex-1",children:[A?(0,o.jsx)(s.Z,{className:"animate-spin mr-2",size:16}):(0,o.jsx)(i.Z,{className:"mr-2",size:16}),"Ma position actuelle"]}),(0,o.jsxs)(l.Z,{type:"button",variant:"outline",disabled:b,onClick:()=>{h&&(h.setCenter({lat:3.8667,lng:11.5167}),h.setZoom(13))},children:[(0,o.jsx)(a.Z,{className:"mr-2",size:16}),"Recentrer Yaound\xe9"]})]}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{ref:p,className:"w-full h-96 rounded-lg border border-gray-300",style:{minHeight:"384px"}}),b&&(0,o.jsx)("div",{className:"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)(s.Z,{className:"animate-spin mx-auto mb-2 text-gray-400",size:24}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:"Chargement de la carte..."})]})})]}),(0,o.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,o.jsx)("p",{children:"\u2022 Cliquez sur la carte pour placer le marqueur"}),(0,o.jsx)("p",{children:"\u2022 Glissez le marqueur pour ajuster la position"}),0!==t&&0!==r&&(0,o.jsxs)("p",{className:"text-green-600 font-medium",children:["Position s\xe9lectionn\xe9e: ",t.toFixed(6),", ",r.toFixed(6)]})]})]})})}},4603:function(e,t,r){r.d(t,{H:function(){return d},a:function(){return u}});var o=r(7437),n=r(2265),a=r(3301),s=r(5978),i=r(6410),l=r(9064);const c=(0,n.createContext)(void 0);function d(e){let{children:t}=e;const[r,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[g,p]=(0,n.useState)(!0);(0,n.useEffect)((()=>{const e=(0,a.Aj)(i.I8,(async e=>{if(m(e),e)try{const o=await(0,s.QT)((0,s.JU)(i.db,"users",e.uid));if(o.exists()){var t,r;const n=o.data();d({id:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:n.role||"user",hospitalId:n.hospitalId,createdAt:(null===(t=n.createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(r=n.updatedAt)||void 0===r?void 0:r.toDate())||new Date})}else{const t={id:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:"user",createdAt:new Date,updatedAt:new Date};await(0,s.pl)((0,s.JU)(i.db,"users",e.uid),{...t,createdAt:new Date,updatedAt:new Date}),d(t)}}catch(n){var o;if(console.error("Error fetching user data:",n),"unavailable"===n.code||(null===(o=n.message)||void 0===o?void 0:o.includes("offline"))){console.warn("Firestore hors ligne - cr\xe9ation d'un utilisateur local temporaire");const t={id:e.uid,email:e.email,displayName:e.displayName||"Utilisateur",photoURL:e.photoURL,role:"user",createdAt:new Date,updatedAt:new Date};d(t),l.ZP.success("Mode hors ligne activ\xe9")}else l.ZP.error("Erreur lors du chargement des donn\xe9es utilisateur")}else d(null);p(!1)}));return()=>e()}),[]);const h={user:r,firebaseUser:u,loading:g,signInWithEmail:async(e,t)=>{try{await(0,a.e5)(i.I8,e,t),l.ZP.success("Connexion r\xe9ussie !")}catch(r){throw console.error("Error signing in:",r),l.ZP.error("Erreur de connexion : "+r.message),r}},signInWithGoogle:async()=>{try{await(0,a.rh)(i.I8,i.Vv),l.ZP.success("Connexion Google r\xe9ussie !")}catch(e){throw console.error("Error signing in with Google:",e),l.ZP.error("Erreur de connexion Google : "+e.message),e}},signUpWithEmail:async(e,t,r)=>{try{const{user:o}=await(0,a.Xb)(i.I8,e,t);await(0,a.ck)(o,{displayName:r});const n={id:o.uid,email:o.email,displayName:r,role:"user",createdAt:new Date,updatedAt:new Date};await(0,s.pl)((0,s.JU)(i.db,"users",o.uid),{...n,createdAt:new Date,updatedAt:new Date}),l.ZP.success("Compte cr\xe9\xe9 avec succ\xe8s !")}catch(o){throw console.error("Error signing up:",o),l.ZP.error("Erreur lors de la cr\xe9ation du compte : "+o.message),o}},logout:async()=>{try{await(0,a.w7)(i.I8),l.ZP.success("D\xe9connexion r\xe9ussie")}catch(e){console.error("Error signing out:",e),l.ZP.error("Erreur lors de la d\xe9connexion")}},updateUserRole:async(e,t)=>{try{await(0,s.r7)((0,s.JU)(i.db,"users",e),{role:t,updatedAt:new Date}),l.ZP.success("R\xf4le utilisateur mis \xe0 jour")}catch(r){throw console.error("Error updating user role:",r),l.ZP.error("Erreur lors de la mise \xe0 jour du r\xf4le"),r}},createFirstSuperAdmin:async e=>{try{const t=(await(0,s.PL)((0,s.hJ)(i.db,"users"))).docs.find((t=>t.data().email===e));t?(await(0,s.r7)((0,s.JU)(i.db,"users",t.id),{role:"super_admin",updatedAt:new Date}),l.ZP.success("Super admin cr\xe9\xe9 avec succ\xe8s"),window.location.reload()):l.ZP.error("Utilisateur non trouv\xe9")}catch(t){console.error("Error creating super admin:",t),l.ZP.error("Erreur lors de la cr\xe9ation du super admin")}}};return(0,o.jsx)(c.Provider,{value:h,children:t})}function u(){const e=(0,n.useContext)(c);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}},6410:function(e,t,r){r.d(t,{I8:function(){return l},Vv:function(){return c},db:function(){return d}});var o=r(738),n=r(3301),a=r(5978),s=r(62);const i=(0,o.ZF)({apiKey:"AIzaSyBLpLQIqKcWgUVYDttXit1x5nRrcFB1RmM",authDomain:"hemoconnect-ec751.firebaseapp.com",projectId:"hemoconnect-ec751",storageBucket:"hemoconnect-ec751.firebasestorage.app",messagingSenderId:"324649213432",appId:"1:324649213432:web:77683bec35f3fe9b4a8a0d"}),l=(0,n.v0)(i),c=new n.hJ;c.setCustomParameters({prompt:"select_account"});const d=(0,a.ad)(i);(0,s.cF)(i)},8237:function(e,t,r){r.d(t,{$I:function(){return s}});let o=!1,n=!1,a=null;const s=()=>o&&window.google&&window.google.maps?Promise.resolve():(n&&a||(a=new Promise(((e,t)=>{if(window.google&&window.google.maps&&window.google.maps.places)return o=!0,void e();n=!0;const r="AIzaSyD_7kY3J-gOmf7D5yK-SwlFap0TrhDp15s";document.querySelectorAll('script[src*="maps.googleapis.com"]').forEach((e=>e.remove())),window.initGoogleMaps&&delete window.initGoogleMaps;const a="initGoogleMapsAPI";window[a]=()=>{o=!0,n=!1,delete window[a],e()};const s=document.createElement("script");s.src="https://maps.googleapis.com/maps/api/js?key=".concat(r,"&libraries=places&region=CM&language=fr&callback=").concat(a),s.async=!0,s.defer=!0,s.onerror=()=>{n=!1,delete window[a],t(new Error("Erreur lors du chargement de l'API Google Maps"))},document.head.appendChild(s),setTimeout((()=>{n&&(n=!1,delete window[a],t(new Error("Timeout lors du chargement de l'API Google Maps")))}),1e4)}))),a)}}]);